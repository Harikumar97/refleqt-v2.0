<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategy Cohorts - Refleqt</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            color: #2d3748;
            line-height: 1.6;
        }

        /* Header & Navigation */
        .main-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo { font-size: 24px; font-weight: bold; }
        
        .nav-breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            opacity: 0.9;
        }

        /* Main Layout */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px;
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 30px;
        }

        /* Strategy Cohort Builder */
        .cohort-builder {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }

        .builder-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 30px;
        }

        .builder-title {
            font-size: 24px;
            font-weight: bold;
            color: #2d3748;
        }

        .builder-subtitle {
            color: #718096;
            margin-bottom: 25px;
            font-size: 16px;
        }

        /* Query Input Section */
        .query-section {
            margin-bottom: 30px;
        }

        .query-label {
            font-weight: 600;
            margin-bottom: 12px;
            color: #4a5568;
        }

        .query-input {
            width: 100%;
            min-height: 100px;
            padding: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            resize: vertical;
            transition: border-color 0.3s;
        }

        .query-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .query-templates {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .template-chip {
            padding: 6px 12px;
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .template-chip:hover {
            background: #667eea;
            color: white;
            border-color: transparent;
        }

        /* Competitor Selection */
        .competitor-section {
            margin-bottom: 30px;
        }

        .competitor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }

        .competitor-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .competitor-item.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .competitor-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 4px;
            position: relative;
        }

        .competitor-item.selected .competitor-checkbox {
            background: #667eea;
            border-color: #667eea;
        }

        .competitor-item.selected .competitor-checkbox::after {
            content: '✓';
            position: absolute;
            top: -2px;
            left: 2px;
            color: white;
            font-size: 12px;
        }

        /* Analysis Options */
        .options-section {
            margin-bottom: 30px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 12px;
        }

        .option-card {
            padding: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .option-card.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .option-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .option-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .option-description {
            font-size: 12px;
            color: #718096;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            flex: 1;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f7fafc;
            color: #4a5568;
            border: 2px solid #e2e8f0;
        }

        .btn-secondary:hover {
            background: #e2e8f0;
        }

        /* Results Section */
        .analysis-results {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            display: none;
        }

        .analysis-results.active {
            display: block;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f7fafc;
        }

        .results-title {
            font-size: 20px;
            font-weight: bold;
        }

        .results-meta {
            font-size: 14px;
            color: #718096;
        }

        /* Export Controls */
        .export-controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .export-btn {
            padding: 8px 12px;
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .export-btn:hover {
            background: #667eea;
            color: white;
        }

        /* Insights Grid */
        .insights-grid {
            display: grid;
            gap: 20px;
            margin-bottom: 30px;
        }

        .insight-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            position: relative;
        }

        .insight-card.high-confidence {
            border-left: 4px solid #48bb78;
        }

        .insight-card.medium-confidence {
            border-left: 4px solid #ed8936;
        }

        .insight-card.low-confidence {
            border-left: 4px solid #f56565;
        }

        .insight-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .insight-title {
            font-weight: 600;
            color: #2d3748;
        }

        .confidence-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .confidence-high {
            background: #c6f6d5;
            color: #22543d;
        }

        .confidence-medium {
            background: #fbd38d;
            color: #744210;
        }

        .confidence-low {
            background: #fed7d7;
            color: #742a2a;
        }

        .insight-content {
            margin-bottom: 16px;
            line-height: 1.6;
        }

        .insight-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .insight-action {
            padding: 6px 10px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .insight-action:hover {
            background: #667eea;
            color: white;
        }

        /* Visualization Section */
        .visualization-section {
            margin: 30px 0;
        }

        .viz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .viz-title {
            font-size: 18px;
            font-weight: 600;
        }

        .viz-controls {
            display: flex;
            gap: 8px;
        }

        .viz-btn {
            padding: 6px 12px;
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
        }

        .viz-container {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        /* Refinement Section */
        .refinement-section {
            background: #f8fafc;
            border: 2px dashed #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
        }

        .refinement-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        /* Side Panel */
        .side-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .panel-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .panel-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #2d3748;
        }

        /* Processing Modal */
        .processing-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .processing-modal.active {
            display: flex;
        }

        .processing-content {
            background: white;
            border-radius: 16px;
            padding: 40px;
            max-width: 500px;
            text-align: center;
        }

        .processing-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid #e2e8f0;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .processing-stage {
            font-size: 16px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 8px;
        }

        .processing-description {
            color: #718096;
            margin-bottom: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .progress-text {
            font-size: 14px;
            color: #718096;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .main-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .competitor-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 20px;
            }
            
            .cohort-builder, .analysis-results {
                padding: 20px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="main-header">
        <div class="logo">Refleqt</div>
        <nav class="nav-breadcrumb">
            <span>Portal</span>
            <span>›</span>
            <span>Strategy Cohorts</span>
        </nav>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Main Content -->
        <div class="main-content">
            <!-- Strategy Cohort Builder -->
            <div class="cohort-builder">
                <div class="builder-header">
                    <div class="builder-title">🎯 Strategy Cohort On-Demand</div>
                </div>
                <p class="builder-subtitle">Get competitive intelligence synthesis within 2 minutes. Ask any strategic question about your competitors.</p>

                <!-- Query Input -->
                <div class="query-section">
                    <div class="query-label">What competitive intelligence do you need?</div>
                    <textarea class="query-input" id="queryInput" placeholder="Example: How are my competitors responding to the new AI regulations? What pricing strategies are they using for enterprise customers?"></textarea>
                    
                    <div class="query-templates">
                        <span class="template-chip" onclick="insertTemplate('pricing')">Pricing Analysis</span>
                        <span class="template-chip" onclick="insertTemplate('features')">Feature Comparison</span>
                        <span class="template-chip" onclick="insertTemplate('marketing')">Marketing Strategy</span>
                        <span class="template-chip" onclick="insertTemplate('positioning')">Market Positioning</span>
                        <span class="template-chip" onclick="insertTemplate('funding')">Funding & Growth</span>
                    </div>
                </div>

                <!-- Competitor Selection -->
                <div class="competitor-section">
                    <div class="query-label">Select Competitors to Analyze</div>
                    <div class="competitor-grid">
                        <div class="competitor-item" onclick="toggleCompetitor(this, 'asana')">
                            <div class="competitor-checkbox"></div>
                            <div>
                                <div class="competitor-name">Asana</div>
                                <div style="font-size: 12px; color: #718096;">Project Management</div>
                            </div>
                        </div>
                        <div class="competitor-item" onclick="toggleCompetitor(this, 'monday')">
                            <div class="competitor-checkbox"></div>
                            <div>
                                <div class="competitor-name">Monday.com</div>
                                <div style="font-size: 12px; color: #718096;">Work OS</div>
                            </div>
                        </div>
                        <div class="competitor-item" onclick="toggleCompetitor(this, 'notion')">
                            <div class="competitor-checkbox"></div>
                            <div>
                                <div class="competitor-name">Notion</div>
                                <div style="font-size: 12px; color: #718096;">All-in-one Workspace</div>
                            </div>
                        </div>
                        <div class="competitor-item" onclick="toggleCompetitor(this, 'clickup')">
                            <div class="competitor-checkbox"></div>
                            <div>
                                <div class="competitor-name">ClickUp</div>
                                <div style="font-size: 12px; color: #718096;">Productivity Platform</div>
                            </div>
                        </div>
                    </div>
                </div>
					
				<!-- Add after competitor selection in strategy-cohorts.html -->
				<div class="psychographic-context">
					<div class="section-label">Customer Psychographic Context</div>
					<div style="display: flex; gap: 8px; margin-bottom: 12px;">
						<button class="template-chip" onclick="addPsychographicContext('trial-abandoners')">
							Trial Abandoners (34%)
						</button>
						<button class="template-chip" onclick="addPsychographicContext('power-customizers')">
							Power Users (23%)
						</button>
						<button class="template-chip" onclick="addPsychographicContext('quick-starters')">
							Quick Starters (28%)
						</button>
					</div>
					<div style="font-size: 12px; color: #718096;">
						Include behavioral context from Funnel-lytics to enhance competitive analysis
					</div>
				</div>	
					
                <!-- Analysis Options -->
                <div class="options-section">
                    <div class="query-label">Analysis Type</div>
                    <div class="options-grid">
                        <div class="option-card selected" onclick="selectOption(this, 'insights')">
                            <div class="option-icon">💡</div>
                            <div class="option-title">Key Insights</div>
                            <div class="option-description">10 structured insights with confidence scores</div>
                        </div>
                        <div class="option-card" onclick="selectOption(this, 'scenarios')">
                            <div class="option-icon">📊</div>
                            <div class="option-title">Strategic Scenarios</div>
                            <div class="option-description">Competitive scenarios with recommendations</div>
                        </div>
                        <div class="option-card" onclick="selectOption(this, 'deep')">
                            <div class="option-icon">🔍</div>
                            <div class="option-title">Deep Analysis</div>
                            <div class="option-description">Comprehensive report with visualizations</div>
                        </div>
                        <div class="option-card" onclick="selectOption(this, 'realtime')">
                            <div class="option-icon">⚡</div>
                            <div class="option-title">Real-time Track</div>
                            <div class="option-description">Continuous monitoring with alerts</div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="runAnalysis()">🎯 Run Strategy Cohort</button>
                    <button class="btn btn-secondary" onclick="saveTemplate()">💾 Save as Template</button>
                    <button class="btn btn-secondary" onclick="scheduleCohort()">📅 Schedule Analysis</button>
                </div>
            </div>

            <!-- Analysis Results -->
            <div class="analysis-results" id="analysisResults">
                <div class="results-header">
                    <div>
                        <div class="results-title">Competitive Intelligence Analysis</div>
                        <div class="results-meta">Analysis completed in 1m 47s • Confidence: 87% • Sources: 23</div>
                    </div>
                    <div class="export-controls">
                        <button class="export-btn" onclick="exportAnalysis('pdf')">
                            📄 PDF Report
                        </button>
                        <button class="export-btn" onclick="exportAnalysis('excel')">
                            📊 Excel Data
                        </button>
                        <button class="export-btn" onclick="exportAnalysis('ppt')">
                            📋 PowerPoint
                        </button>
                        <button class="export-btn" onclick="showExportOptions()">
                            ⚙️ More Options
                        </button>
                    </div>
                </div>

                <!-- Key Insights -->
                <div class="insights-grid" id="insightsGrid">
                    <!-- Insights will be dynamically populated -->
                </div>

                <!-- Visualization Section -->
                <div class="visualization-section">
                    <div class="viz-header">
                        <div class="viz-title">📊 Competitive Analysis Charts</div>
                        <div class="viz-controls">
                            <button class="viz-btn" onclick="switchChart('positioning')">Positioning</button>
                            <button class="viz-btn" onclick="switchChart('trends')">Trends</button>
                            <button class="viz-btn" onclick="switchChart('features')">Features</button>
                            <button class="viz-btn" onclick="expandChart()">🔍 Expand</button>
                        </div>
                    </div>
                    
                    <div class="viz-container">
                        <canvas id="competitiveChart" width="400" height="200"></canvas>
                    </div>
                </div>

                <!-- Refinement Section -->
                <div class="refinement-section">
                    <div style="font-weight: 600; margin-bottom: 12px;">💬 Refine Your Analysis</div>
                    <input type="text" class="refinement-input" id="refinementInput" placeholder="Ask follow-up questions or request specific details...">
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-secondary" onclick="refineAnalysis()">Refine Analysis</button>
                        <button class="btn btn-secondary" onclick="addCompetitors()">Add Competitors</button>
                        <button class="btn btn-secondary" onclick="changeScope()">Change Scope</button>
                    </div>
                    <div style="font-size: 12px; color: #718096; margin-top: 8px;">
                        Refinements remaining: <strong>4/5</strong> • Each refinement improves analysis quality
                    </div>
                </div>
            </div>
        </div>

        <!-- Side Panel -->
        <div class="side-panel">
            <!-- Active Analyses -->
            <div class="panel-card">
                <div class="panel-title">🔄 Active Analyses</div>
                <div id="activeAnalyses">
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px; margin-bottom: 8px;">
                        <div style="font-weight: 600; font-size: 14px;">Pricing Strategy Analysis</div>
                        <div style="font-size: 12px; color: #718096;">Running • 34s elapsed</div>
                        <div style="width: 100%; height: 4px; background: #e2e8f0; border-radius: 2px; margin-top: 8px;">
                            <div style="width: 65%; height: 100%; background: #667eea; border-radius: 2px;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="panel-card">
                <div class="panel-title">📈 Analysis Stats</div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                    <div style="text-align: center; padding: 12px; background: #f8fafc; border-radius: 8px;">
                        <div style="font-size: 20px; font-weight: bold; color: #667eea;">23</div>
                        <div style="font-size: 12px; color: #718096;">This Month</div>
                    </div>
                    <div style="text-align: center; padding: 12px; background: #f8fafc; border-radius: 8px;">
                        <div style="font-size: 20px; font-weight: bold; color: #48bb78;">94%</div>
                        <div style="font-size: 12px; color: #718096;">Avg Confidence</div>
                    </div>
                    <div style="text-align: center; padding: 12px; background: #f8fafc; border-radius: 8px;">
                        <div style="font-size: 20px; font-weight: bold; color: #ed8936;">1m 34s</div>
                        <div style="font-size: 12px; color: #718096;">Avg Time</div>
                    </div>
                    <div style="text-align: center; padding: 12px; background: #f8fafc; border-radius: 8px;">
                        <div style="font-size: 20px; font-weight: bold; color: #9f7aea;">12</div>
                        <div style="font-size: 12px; color: #718096;">Competitors</div>
                    </div>
                </div>
            </div>

            <!-- Recent Templates -->
            <div class="panel-card">
                <div class="panel-title">🚀 Quick Templates</div>
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    <div style="padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='white'">
                        <div style="font-weight: 600; font-size: 14px;">Pricing Intel</div>
                        <div style="font-size: 12px; color: #718096;">Compare competitor pricing strategies</div>
                    </div>
                    <div style="padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='white'">
                        <div style="font-weight: 600; font-size: 14px;">Feature Gap Analysis</div>
                        <div style="font-size: 12px; color: #718096;">Identify missing capabilities</div>
                    </div>
                    <div style="padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='white'">
                        <div style="font-weight: 600; font-size: 14px;">Market Response</div>
                        <div style="font-size: 12px; color: #718096;">How competitors react to trends</div>
                    </div>
                </div>
            </div>

            <!-- Integration Status -->
            <div class="panel-card">
                <div class="panel-title">🔗 Platform Integration</div>
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 14px;">Research Swarm</span>
                        <span style="color: #48bb78;">● Active</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 14px;">Funnel-lytics</span>
                        <span style="color: #ed8936;">● Syncing</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 14px;">PM Dashboard</span>
                        <span style="color: #48bb78;">● Ready</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Processing Modal -->
    <div class="processing-modal" id="processingModal">
        <div class="processing-content">
            <div class="processing-spinner"></div>
            <div class="processing-stage" id="processingStage">Initializing Analysis</div>
            <div class="processing-description" id="processingDescription">Setting up AI agents for competitor data collection...</div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-text" id="progressText">0% complete</div>
            
            <div style="margin-top: 20px;">
                <button class="btn btn-secondary" onclick="cancelAnalysis()">Cancel Analysis</button>
            </div>
        </div>
    </div>

    <!-- Export Options Modal -->
    <div class="processing-modal" id="exportModal">
        <div class="processing-content">
            <h3 style="margin-bottom: 20px;">📄 Export Options</h3>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 20px;">
                <div class="option-card" onclick="selectExportOption(this, 'executive-pdf')">
                    <div class="option-icon">📋</div>
                    <div class="option-title">Executive PDF</div>
                    <div class="option-description">Key insights + recommendations</div>
                </div>
                <div class="option-card" onclick="selectExportOption(this, 'detailed-word')">
                    <div class="option-icon">📄</div>
                    <div class="option-title">Detailed Report</div>
                    <div class="option-description">Complete analysis with sources</div>
                </div>
                <div class="option-card" onclick="selectExportOption(this, 'data-excel')">
                    <div class="option-icon">📊</div>
                    <div class="option-title">Data Export</div>
                    <div class="option-description">Raw data for analysis</div>
                </div>
                <div class="option-card" onclick="selectExportOption(this, 'presentation')">
                    <div class="option-icon">🎯</div>
                    <div class="option-title">Presentation</div>
                    <div class="option-description">Ready-to-present slides</div>
                </div>
            </div>

            <div style="margin-bottom: 20px;">
                <label style="font-weight: 600; margin-bottom: 8px; display: block;">Partial Export Options:</label>
                <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                    <label style="display: flex; align-items: center; gap: 4px; font-size: 14px;">
                        <input type="checkbox" id="exportSources"> Sources Only
                    </label>
                    <label style="display: flex; align-items: center; gap: 4px; font-size: 14px;">
                        <input type="checkbox" id="exportCharts"> Charts & Visualizations
                    </label>
                    <label style="display: flex; align-items: center; gap: 4px; font-size: 14px;">
                        <input type="checkbox" id="exportSelected"> Selected Insights
                    </label>
                </div>
            </div>

            <div style="display: flex; gap: 12px;">
                <button class="btn btn-primary" onclick="processExport()">Generate Export</button>
                <button class="btn btn-secondary" onclick="closeExportModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let selectedCompetitors = [];
        let analysisType = 'insights';
        let currentChart = null;
        let analysisData = null;

        // Template insertion
        function insertTemplate(type) {
            const templates = {
                pricing: "Analyze competitor pricing strategies for enterprise customers. How do their pricing tiers compare and what value propositions do they emphasize?",
                features: "Compare key features and capabilities across competitors. What unique features do they offer and where are the gaps in our offering?",
                marketing: "How are competitors positioning themselves in the market? What messaging and channels are they using to reach customers?",
                positioning: "Analyze competitor market positioning and brand messaging. How do they differentiate from each other and from us?",
                funding: "What is the funding status and growth trajectory of key competitors? How does this impact their competitive strategy?"
            };
            
            document.getElementById('queryInput').value = templates[type] || '';
        }

        // Competitor selection
        function toggleCompetitor(element, competitor) {
            element.classList.toggle('selected');
            
            if (selectedCompetitors.includes(competitor)) {
                selectedCompetitors = selectedCompetitors.filter(c => c !== competitor);
            } else {
                selectedCompetitors.push(competitor);
            }
            
            console.log('Selected competitors:', selectedCompetitors);
        }

        // Option selection
        function selectOption(element, option) {
            // Remove selected class from all options
            document.querySelectorAll('.option-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selected class to clicked option
            element.classList.add('selected');
            analysisType = option;
            
            console.log('Selected analysis type:', analysisType);
        }

        // Run analysis
        function runAnalysis() {
            const query = document.getElementById('queryInput').value;
            
            if (!query.trim()) {
                alert('Please enter your competitive intelligence question.');
                return;
            }
            
            if (selectedCompetitors.length === 0) {
                alert('Please select at least one competitor to analyze.');
                return;
            }
            
            // Show processing modal
            showProcessingModal();
            
            // Simulate analysis process
            simulateAnalysis();
        }

        // Show processing modal
        function showProcessingModal() {
            document.getElementById('processingModal').classList.add('active');
        }

        // Hide processing modal
        function hideProcessingModal() {
            document.getElementById('processingModal').classList.remove('active');
        }

        // Simulate analysis process
        function simulateAnalysis() {
            const stages = [
                { stage: "Initializing Analysis", description: "Setting up AI agents for competitor data collection...", progress: 0 },
                { stage: "Data Collection", description: "Scraping competitor websites and gathering intelligence...", progress: 25 },
                { stage: "Processing Data", description: "Analyzing collected information with AI synthesis...", progress: 50 },
                { stage: "Generating Insights", description: "Creating structured insights with confidence scores...", progress: 75 },
                { stage: "Finalizing Results", description: "Preparing visualizations and export options...", progress: 90 },
                { stage: "Complete", description: "Analysis complete! Displaying results...", progress: 100 }
            ];
            
            let currentStage = 0;
            
            const interval = setInterval(() => {
                if (currentStage < stages.length) {
                    const stage = stages[currentStage];
                    document.getElementById('processingStage').textContent = stage.stage;
                    document.getElementById('processingDescription').textContent = stage.description;
                    document.getElementById('progressFill').style.width = stage.progress + '%';
                    document.getElementById('progressText').textContent = stage.progress + '% complete';
                    
                    currentStage++;
                } else {
                    clearInterval(interval);
                    hideProcessingModal();
                    showResults();
                }
            }, 1500);
        }

        // Show analysis results
        function showResults() {
            document.getElementById('analysisResults').classList.add('active');
            populateInsights();
            createChart();
            
            // Scroll to results
            document.getElementById('analysisResults').scrollIntoView({ behavior: 'smooth' });
        }

        // Populate insights
        function populateInsights() {
            const sampleInsights = [
                {
                    title: "Pricing Strategy Differentiation",
                    content: "Asana and Monday.com are positioning themselves 15-20% higher than ClickUp in enterprise tiers, focusing on advanced workflow automation as value justification.",
                    confidence: "high",
                    sources: ["asana.com/pricing", "monday.com/pricing", "clickup.com/pricing"]
                },
                {
                    title: "AI Feature Integration",
                    content: "All major competitors are rapidly integrating AI features, with Notion leading in AI writing assistance and ClickUp focusing on AI project summarization.",
                    confidence: "high",
                    sources: ["product release notes", "feature announcements"]
                },
                {
                    title: "Enterprise Sales Strategy",
                    content: "Monday.com has significantly increased their enterprise sales team by 40% in Q3, indicating aggressive enterprise market expansion.",
                    confidence: "medium",
                    sources: ["linkedin job postings", "company announcements"]
                },
                {
                    title: "Customer Retention Focus",
                    content: "Asana is investing heavily in customer success programs, with 65% increase in CS team size, suggesting potential churn challenges.",
                    confidence: "medium",
                    sources: ["hiring data", "customer forum activity"]
                },
                {
                    title: "Mobile Experience Gap",
                    content: "ClickUp's mobile app has significantly lower ratings (3.2/5) compared to competitors, presenting a potential differentiation opportunity.",
                    confidence: "high",
                    sources: ["app store ratings", "user reviews"]
                }
            ];
            
            const insightsGrid = document.getElementById('insightsGrid');
            insightsGrid.innerHTML = '';
            
            sampleInsights.forEach(insight => {
                const insightCard = document.createElement('div');
                insightCard.className = `insight-card ${insight.confidence}-confidence`;
                
                insightCard.innerHTML = `
                    <div class="insight-header">
                        <div class="insight-title">${insight.title}</div>
                        <div class="confidence-badge confidence-${insight.confidence}">${insight.confidence} confidence</div>
                    </div>
                    <div class="insight-content">${insight.content}</div>
                    <div class="insight-actions">
                        <button class="insight-action" onclick="drillDown('${insight.title}')">🔍 Drill Down</button>
                        <button class="insight-action" onclick="addToReport('${insight.title}')">📄 Add to Report</button>
                        <button class="insight-action" onclick="createTask('${insight.title}')">✅ Create Task</button>
                        <button class="insight-action" onclick="setAlert('${insight.title}')">🔔 Set Alert</button>
                    </div>
                `;
                
                insightsGrid.appendChild(insightCard);
            });
        }

        // Create chart
        function createChart() {
            const ctx = document.getElementById('competitiveChart').getContext('2d');
            
            if (currentChart) {
                currentChart.destroy();
            }
            
            currentChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Market Position',
                        data: [
                            { x: 3.5, y: 4.2, label: 'Asana' },
                            { x: 4.1, y: 3.8, label: 'Monday.com' },
                            { x: 2.8, y: 4.0, label: 'ClickUp' },
                            { x: 3.2, y: 4.5, label: 'Notion' },
                            { x: 3.0, y: 3.5, label: 'Your Product' }
                        ],
                        backgroundColor: [
                            '#667eea',
                            '#f093fb',
                            '#ffd89b',
                            '#19d4ee',
                            '#ff6b6b'
                        ],
                        pointRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Competitive Positioning: Features vs Price Value'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.raw.label + ': (' + context.parsed.x + ', ' + context.parsed.y + ')';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Price Competitiveness'
                            },
                            min: 2,
                            max: 5
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Feature Richness'
                            },
                            min: 3,
                            max: 5
                        }
                    }
                }
            });
        }

        // Chart switching
        function switchChart(type) {
            console.log('Switching to chart type:', type);
            // Implementation would switch between different chart types
        }

        // Export functions
        function exportAnalysis(format) {
            console.log('Exporting analysis as:', format);
            
            // Simulate export process
            const formats = {
                pdf: 'Executive Summary PDF',
                excel: 'Competitive Data Excel',
                ppt: 'Strategy Presentation PowerPoint'
            };
            
            alert(`Generating ${formats[format]}... Download will start shortly.`);
        }

        function showExportOptions() {
            document.getElementById('exportModal').classList.add('active');
        }

        function closeExportModal() {
            document.getElementById('exportModal').classList.remove('active');
        }

        function selectExportOption(element, option) {
            // Remove selected from all export options
            document.querySelectorAll('#exportModal .option-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            element.classList.add('selected');
            console.log('Selected export option:', option);
        }

        function processExport() {
            const selectedFormat = document.querySelector('#exportModal .option-card.selected');
            const includesSources = document.getElementById('exportSources').checked;
            const includesCharts = document.getElementById('exportCharts').checked;
            const includesSelected = document.getElementById('exportSelected').checked;
            
            console.log('Processing export with options:', {
                format: selectedFormat?.dataset?.format || 'executive-pdf',
                sources: includesSources,
                charts: includesCharts,
                selected: includesSelected
            });
            
            alert('Export is being generated... You will receive an email when ready.');
            closeExportModal();
        }

        // Refinement functions
        function refineAnalysis() {
            const refinementQuery = document.getElementById('refinementInput').value;
            if (!refinementQuery.trim()) {
                alert('Please enter a refinement question.');
                return;
            }
            
            console.log('Refining analysis with:', refinementQuery);
            alert('Refining analysis... Updated results will appear shortly.');
            
            // Clear the input
            document.getElementById('refinementInput').value = '';
        }

        // Insight actions
        function drillDown(title) {
            console.log('Drilling down on:', title);
            alert(`Opening detailed analysis for: ${title}`);
        }

        function addToReport(title) {
            console.log('Adding to report:', title);
            alert(`Added "${title}" to your report compilation.`);
        }

        function createTask(title) {
            console.log('Creating task for:', title);
            alert(`Created task in PM Dashboard: "Analyze ${title}"`);
        }

        function setAlert(title) {
            console.log('Setting alert for:', title);
            alert(`Alert set for changes related to: ${title}`);
        }

        // Additional functions
        function saveTemplate() {
            alert('Analysis configuration saved as template!');
        }

        function scheduleCohort() {
            alert('Opening scheduling interface...');
        }

        function cancelAnalysis() {
            hideProcessingModal();
            alert('Analysis cancelled.');
        }

        function expandChart() {
            alert('Opening full-screen chart view...');
        }

        function addCompetitors() {
            alert('Opening competitor selection...');
        }

        function changeScope() {
            alert('Opening scope modification...');
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Strategy Cohorts page initialized');
        });
    </script>
</body>
</html>
